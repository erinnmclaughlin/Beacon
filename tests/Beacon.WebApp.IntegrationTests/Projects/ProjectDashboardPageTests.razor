@using Beacon.Common.Models
@using Beacon.Common.Requests.Projects
@using BeaconUI.Core.Projects.Pages
@inherits BeaconTestContext

@code {
    private static ProjectDto TestProject { get; } = new ProjectDto
    {
        Id = Guid.NewGuid(),
        ProjectCode = "P12345",
        CustomerName = "Test Customer",
        Applications = new List<string> { "App1", "App2" },
        ProjectStatus = ProjectStatus.Active,
        LeadAnalyst = new LaboratoryMemberDto { DisplayName = "Test Analyst" }
    };

    [Fact]
    public void ProjectDashboardPage_DisplaysCorrectData()
    {
        MockApi.Succeeds<GetProjectsRequest, PagedList<ProjectDto>>(new PagedList<ProjectDto>(new[] { TestProject }, 1, 1, 1));

        var sut = Render(@<ProjectDashboardPage />);
        sut.WaitForAssertion(() =>
        {
            sut.Markup.Should()
                .Contain(TestProject.ProjectCode).And
                .Contain(TestProject.CustomerName).And
                .Contain(TestProject.Applications.First()).And
                .Contain(TestProject.ProjectStatus.ToString()).And
                .Contain(TestProject.LeadAnalyst.DisplayName);
        }, TimeSpan.FromSeconds(5));
    }

    [Fact]
    public void ProjectDashboardPage_DisplaysErrorWhenApiCallFails()
    {
        MockApi.Fails<GetProjectsRequest, PagedList<ProjectDto>>();

        var sut = Render(@<ProjectDashboardPage />);
        sut.WaitForAssertion(() => sut.Markup.Should().Contain("error"), TimeSpan.FromSeconds(5));
    }
}
